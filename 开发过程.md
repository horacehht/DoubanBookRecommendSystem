# å¼€å‘è¿‡ç¨‹

## 1.ç•Œé¢åˆ¶ä½œ

è¯¥åº“çš„å­¦ä¹ è¿‡ç¨‹å¯ç§»æ­¥è‡³learn_pyqt5.mdæ–‡ä»¶

### 1.ç™»å½•/æ³¨å†Œç•Œé¢

```python
import res  # å¯¼å…¥èµ„æºæ–‡ä»¶
import sys
from PyQt5.QtGui import QIcon
from PyQt5.QtWidgets import QLabel, QHBoxLayout, QVBoxLayout, QWidget, QLineEdit, QPushButton, QGridLayout


class Demo(QWidget):
    def __init__(self):
        super(Demo, self).__init__()
        self.resize(400, 200)  # çª—å£å°ºå¯¸
        self.setWindowTitle('è±†ç“£ä¹¦ç±æ¨èç³»ç»Ÿ')  # è®¾ç½®çª—å£æ ‡é¢˜
        self.setWindowIcon(QIcon(':res/douban.ico'))  # è®¾ç½®çª—å£å›¾æ ‡
        self.user_label = QLabel('ç”¨æˆ·å:', self)  # æ–‡æœ¬è®¾ç½®
        self.pwd_label = QLabel('å¯†ç :', self)
        self.user_line = QLineEdit(self)  # å•è¡Œæ–‡æœ¬ç¼–è¾‘å™¨
        self.pwd_line = QLineEdit(self)
        self.login_button = QPushButton('ç™»å½•', self)  # æŒ‰é’®
        self.signin_button = QPushButton('æ³¨å†Œ', self)

        # å¸ƒå±€å®ä¾‹åŒ–
        self.g_layout = QGridLayout()  # ç½‘æ ¼å¸ƒå±€
        self.h_layout = QHBoxLayout()  # æ°´å¹³å¸ƒå±€
        self.v_layout = QVBoxLayout()  # å‚ç›´å¸ƒå±€

        self.layout_init()

    def layout_init(self):
        """å¸ƒå±€è®¾ç½®ï¼Œç›®çš„æ˜¯ä½¿initæ–¹æ³•çœ‹èµ·æ¥ç®€æ´
        """

        self.g_layout.addWidget(self.user_label, 0, 0, 2, 1)  # åŠ å…¥æ§ä»¶
        self.g_layout.addWidget(self.user_line, 0, 1, 2, 1)
        self.g_layout.addWidget(self.pwd_label, 1, 0, 2, 1)
        self.g_layout.addWidget(self.pwd_line, 1, 1, 2, 1)

        self.h_layout.addWidget(self.login_button)  # æ·»åŠ ç™»å½•æŒ‰é’®
        self.h_layout.addWidget(self.signin_button)  # æ·»åŠ æ³¨å†ŒæŒ‰é’®
        self.v_layout.addLayout(self.g_layout)  # å°†å¸ƒå±€æ·»åŠ åˆ°æ¡†çš„æœ«å°¾
        self.v_layout.addLayout(self.h_layout)

        self.setLayout(self.v_layout)
```

#### 1.g_layout.addWidget

æˆ‘ç”¨çš„æ˜¯é‡è½½ç‰ˆæœ¬ï¼Œå¯é€šè¿‡Qt assistantçŸ¥å…¶è¯¦ç»†ç”¨æ³•

![image-20210502173110634](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210502173110634.png)

è¯¥å•å…ƒæ ¼å°†ä»fromRow, fromColumnå¼€å§‹ï¼Œè·¨è¶ŠrowSpanè¡Œå’ŒcolumnSpanåˆ—ã€‚è¯¥å°ç»„ä»¶å°†æœ‰ç»™å®šçš„å¯¹é½æ–¹å¼ã€‚

ä¼šæ¯”ä¹‹å‰å¸¸ç”¨çš„é‚£ä¸ªaddWidgetå¥½çœ‹

#### 2.æ•°æ®åº“æ“ä½œ

æŸ¥è¯¢ç»“æœçš„æ—¶å€™è€æ˜¯è¯´ä¸å­˜åœ¨è¿™ä¸ªåˆ—

å›å»W3Schoolçœ‹äº†çœ‹ï¼Œåœ¨jupyter labä¸Šè¯•äº†ä¸€ä¸‹ï¼Œç»“æœå‘ç°è¦åŠ å¼•å·

![image-20210503141635767](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210503141635767.png)

![image-20210503141723639](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210503141723639.png)

é‚£ä¸ª'Horace'ä¸åŠ ()ä¹Ÿè¡Œ

3.ç™»å½•bug

![image-20210503152502678](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210503152502678.png)

æˆ‘èµ·åˆä»¥ä¸ºåˆæ˜¯æˆ‘çš„sqlè¯­å¥å†™é”™äº†ï¼Œæ ¹æ®ä¸Šé¢é‚£ä¸ªæ¥çœ‹ï¼Œæ˜¾ç„¶ä¸æ˜¯ã€‚

åªå¥½print('hello world')ä¸€å¥ä¸€å¥debugäº†ã€‚

æ‰¾å‡ºæ¥äº†ã€‚æ˜¯ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­å‡ºçš„é”™ã€‚

![image-20210503163717591](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210503163717591.png)

~~self.account_presentè™½è¯´æˆ‘ä¹Ÿä¸çŸ¥é“é”™å“ªäº†ï¼Œä½†ç¡®å®ä¸èƒ½è¿™æ ·å†™ã€‚~~fuckã€‚æˆ‘çªç„¶æƒ³èµ·æ¥æˆ‘å‰é¢çš„å˜é‡åå†™çš„æ˜¯account_presence



ç™»å½•ç•Œé¢/æ³¨å†Œç•Œé¢å·²ç»ç¼–å†™å®Œæ¯•ã€‚

```mermaid
graph LR
    start(æ³¨å†Œç™»å½•ç•Œé¢)-->btnclicked{æŒ‰é’®}-->æ³¨å†Œ-->judge1{è´¦å·æ˜¯å¦å­˜åœ¨}-->yes1>æ˜¯]-->æç¤ºè´¦å·å·²å­˜åœ¨
    judge1-->no1>å¦]-->é€‰æ‹©çˆ±çœ‹çš„ä¹¦çš„ç±»å‹-->è¿›å…¥ä¸»é¡µé¢
    btnclicked-->ç™»é™†-->judge2{è´¦å·æ˜¯å¦å­˜åœ¨}-->yes2>æ˜¯]-->namepwd{è´¦å·å¯†ç æ˜¯å¦åŒ¹é…}-->ä¸åŒ¹é…-->æç¤ºè´¦å·æˆ–å¯†ç é”™è¯¯
    namepwd-->åŒ¹é…-->è¿›å…¥ä¸»é¡µé¢
    judge2-->no2>å¦]-->æç¤ºéœ€è¦æ³¨å†Œ
```

ä¸Šè¿°çš„æµç¨‹å›¾æ‰€æåˆ°çš„åŠŸèƒ½å·²å®ç°ã€‚

### 2.ä¸»é¡µé¢

ç”±äºè®¾æƒ³çš„æ˜¯**å·¦å³åˆ†åŒº**ï¼Œåˆ†ä¸º**ä¸ªæ€§åŒ–æ¨è**å’Œ**çƒ­é—¨ä¹¦ç±æ¨è**

ä¸ªæ€§åŒ–æ¨èå°±è¦æ¶‰åŠç®—æ³•å’Œæ•°æ®çš„çˆ¬å–äº†ï¼Œæ‰€ä»¥è¦å»ç¼–å†™ç®—æ³•å’Œçˆ¬è™«

çƒ­é—¨ä¹¦ç±çš„è¯ä¹Ÿè¦æ¶‰åŠçˆ¬è™«ã€‚

æ‰€ä»¥å…ˆçˆ¬è™«å§ã€‚

æœ‰äº›ç‰¹å¾æ˜¯ä¹¦éƒ½å…±æœ‰çš„ï¼šæˆ‘ä»¬çˆ¬å–è¿™äº›å­—æ®µã€‚

ä½œè€…ï¼Œå‡ºç‰ˆç¤¾ï¼Œå‡ºç‰ˆå¹´ï¼Œé¡µæ•°ï¼Œå®šä»·ï¼Œè£…å¸§ï¼ŒISBNã€‚

æœ‰äº›éš¾çˆ¬...å¦‚æœè´¸ç„¶è¿½æ±‚æ•°æ®ç²¾åº¦ä¼šå¯¼è‡´æ—¶é—´ä¸Šæå¤§çš„æ¶ˆè€—ã€‚

æˆ‘ä¸ªäººè§‰å¾—è¿˜æ˜¯å…ˆçœ‹æ‡‚ç®—æ³•ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„æ•°æ®å°±è‡ªç„¶æµ®å‡ºæ°´é¢ã€‚

### 3.æœç´¢ğŸ”é¡µé¢

csdnä¸ŠæŸ¥åˆ°äº†pd['ç‰¹å¾'].str.containså¯ä»¥å®ç°æ¨¡ç³Šæœç´¢åŠŸèƒ½ã€‚

åšå®Œäº†ã€‚è¿˜å®ç°äº†ä¸‰ä¸ªæ˜¾ç¤ºæ–¹å¼ï¼Œé»˜è®¤ï¼Œè¯„åˆ†ï¼ˆé™åºï¼‰ï¼Œè¯„åˆ†äººæ•°ï¼ˆé™åºï¼‰ï¼Œå…¶ä¸­é™åºåŠŸèƒ½ç‚¹ä¸€æ¬¡ä¼šå˜å‡åºï¼ŒæŒºç®€å•çš„ã€‚åŸç†å…¶å®å¾ˆç®€å•ã€‚

### 4.ä¹¦ç±ğŸ“•è¯¦æƒ…é¡µé¢

å› ä¸ºè¦æ˜¾ç¤ºå›¾ç‰‡ï¼Œæ‰€ä»¥è¦ç”¨Qpixmapè¿™ä¸ªç±»ã€‚

æˆ‘ä»¬å»çœ‹çœ‹å›¾ç‰‡

![image-20210505111649216](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210505111649216.png)

**å…±æœ‰3000æœ¬ä¹¦**ï¼Œåªæœ‰**2988å¼ å›¾ç‰‡**ï¼Œç‚¹å‡»ä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹å±æ€§ï¼Œå‘ç°æ˜¯pngï¼Œå†æœç´¢.pngï¼Œå‘ç°pngæ ¼å¼çš„æ˜¯2982å¼ ã€‚

æ‰€ä»¥åœ¨è¯»å–å›¾ç‰‡æ—¶æœ‰ä¸€å®šçš„å›°æ‰°ã€‚ç»è¿‡ä»£ç æ£€éªŒå’ŒæŸ¥æ‰¾

å‘ç°ä¸æ˜¯pngæ–‡ä»¶çš„ï¼Œå®ƒå‹æ ¹å°±ä¸æ˜¯å›¾ç‰‡ï¼ï¼ï¼

ä¸æ˜¯ï¼Œè¿™æ€ä¹ˆæ”¾è¿›æ¥çš„å•Šã€‚

![image-20210505120249599](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210505120249599.png)

~~ã€ŠåŸæ¥å¦‚æ­¤ã€‹~~

ç”±äºæ•°é‡æ¯”è¾ƒå°‘ï¼Œåªæœ‰å…­å¼ ï¼Œé‚£æˆ‘å°±ä¸€å¼ ä¸€å¼ åˆ æ‰å¥½äº†ã€‚

è¿™æ ·å¤„ç†çš„æƒ…å†µå°±å˜å°‘äº†ã€‚

è§‚å¯Ÿåˆ°æœ‰æŸäº›ç‰¹å¾æ•°æ®ç¼ºå¤±ï¼Œæ‰€ä»¥è¦åœ¨ä½¿ç”¨æ—¶å¯¹è¯»å‡ºæ¥çš„æ•°æ®è¿›è¡Œç®€å•çš„å¤„ç†

å¦‚æœæ•°æ®ç¼ºå¤±ï¼Œå°±å†™æˆç©º''ã€‚ä½†æˆ‘å‘ç°æœ¬èº«ç¼ºå¤±çš„æ•°æ®å¡«çš„å°±æ˜¯''ï¼Œè€Œä¸æ˜¯NaNï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥èµ‹å€¼

![image-20210505164608189](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210505164608189.png)

ç»è¿‡ä¸€ç³»åˆ—çš„ç¼–å†™ï¼Œä¹¦ç±é¡µé¢æ¨ªç©ºå‡ºä¸–ã€‚â€™

åˆ©ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•

```python
if __name__ == "__main__":
    app = QApplication(sys.argv)
    info = BookInfo("ä¸è€æ³‰")
    info.show()
    sys.exit(app.exec_())
```

![image-20210507133423243](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210507133423243.png)

æ•´ä½“æ˜¯è¿™æ ·å­ã€‚åç»­åº”è¯¥è¦æŠŠå–œæ¬¢è¿™æœ¬ä¹¦çš„æŒ‰é’®æ”¹ä¸ºè¯„å¤šå°‘åˆ†ï¼Œ5ï¼Œ4ï¼Œ3ï¼Œ2ï¼Œ1å„æ¥å„æŒ‰é’®ã€‚æ²¡è¯„åˆ†å°±æ˜¯0ã€‚

è¿™æ ·å°±å¯ä»¥è¦ä¹ˆè¯„äº†åˆ†è¦ä¹ˆæ²¡è¯„åˆ†ã€‚

å¦‚æœæ˜¯è®¾ç½®å–œæ¬¢åå†è¯„åˆ†ï¼Œè¿™æ ·çš„è¯ç”¨æˆ·å°±å¯ä»¥é’»ç©ºå­ï¼Œæˆ‘ç‚¹äº†å–œæ¬¢å°±æ˜¯ä¸è¯„åˆ†ã€‚æçš„æ•°æ®å¾ˆå¥‡æ€ªã€‚

### 5.ä¸»é¡µé¢å†…è¯¦ç»†ä¿¡æ¯

```python
book_name = self.book_to_know_line.text()
self.book_info_button.clicked.connect(lambda: self.show_book_info(book_name))
```

å±…ç„¶å±•ç¤ºæœç´¢ä¸åˆ°ï¼Ÿ

![](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210508170834102.png)

ä½†æ˜¯å†™æˆè¿™æ ·ï¼Œä¹Ÿå°±æ˜¯æ²¡ç»è¿‡å˜é‡å­˜å‚¨ï¼Œå±…ç„¶å°±èƒ½æœåˆ°äº†

```python
self.book_info_button.clicked.connect(lambda: self.show_book_info(self.book_to_know_line.text()))
```

![image-20210508171736528](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210508171736528.png)

ä¸‹é¢æ˜¯ä¼ ç»™ç”¨æˆ·ä¸­å¿ƒçš„å‚æ•°user_book_and_scoreã€‚

æœ¬æ„æ˜¯æƒ³å®šä½å‡ºæ¥è¯¥ç”¨æˆ·ç„¶åé€‰æ‹©å…¶read_book_and_scoreé¡¹å†å°†å…¶è½¬æˆå­—å…¸å½¢å¼ï¼Œå–å®ƒçš„é”®ï¼Œä¹Ÿå°±æ˜¯ä¹¦åï¼Œç»„æˆåˆ—è¡¨ã€‚

```python
self.user_read_books = list(eval(self.user_df[self.user_df['nickname'] == self.user]['read_book_and_score']).keys())
TypeError: eval() arg 1 must be a string, bytes or code object
```

ä½†æ˜¯å´æŠ¥é”™äº†ã€‚

åœ¨jupyter labä¸­å°è¯•å‡ºæ¥æ‰å‘ç°ï¼Œè¿™æ ·å®šä½å‡ºæ¥çš„æ˜¯ä¸ª**serieså¯¹è±¡**

![image-20210508181146064](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210508181146064.png)

è€Œæˆ‘å®éªŒçš„æ—¶å€™æ˜¯ç”¨ilocï¼Œä»–è¿™æ ·å®šä½å‡ºæ¥çš„ç›´æ¥æ˜¯å€¼ï¼Œstrç±»å‹ï¼Œå¯ä»¥ç›´æ¥evalè½¬æ¢

![image-20210508181348277](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210508181348277.png)

æ‰€ä»¥æˆ‘ç°åœ¨è¦é€šè¿‡ilocæ¥å®šä½ã€‚é€šè¿‡indexæ¥è·å–userçš„ç´¢å¼•

![image-20210508182219320](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210508182219320.png)

### 6.

æœ¬èº«æƒ³ç€æ ¹æ®å¹´ä»½æ¥ç¡®å®šçƒ­é—¨ä¹¦ç±ï¼Œä½†æˆ‘è§‰å¾—çƒ­é—¨ä¹¦ç±è·Ÿå¹´ä»½æ˜¯æ²¡æœ‰ä»€ä¹ˆå…³ç³»çš„ï¼Œç»å…¸æ°¸æµä¼ ã€‚åº”è¯¥æ˜¯æ ¹æ®è¯„åˆ†å’Œè¯„è®ºäººæ•°æ¥è®¢æ‰æ¯”è¾ƒåˆç†ï¼Œæ‰€ä»¥å°±ä¸å¯¹å¹´ä»½è¿›è¡Œå¤„ç†äº†ã€‚

åœ¨è¿™è¿˜æ˜¯è¦è´´ä¸‹æˆ‘å¤„ç†å¹´ä»½æ•°æ®çš„ä»£ç 

```
# å¤„ç†publishing_yearå­—æ®µï¼Œå°†å…¶æ•´ç†ä¸º2014è¿™ç§å¹´ä»½æ•°æ®
        for i in range(len(self.books_df)):
            pub_year = self.books_df.iloc[i][2]
            try:
                self.books_df['publishing_year'][i] = int(pub_year)
                # è¿™é‡Œä¸èƒ½ç”¨ilocé€‰å–ï¼Œå› ä¸ºilocé€‰å–å‡ºæ¥çš„æ˜¯å‰¯æœ¬ï¼Œæ”¹å˜ä¸äº†åŸæ¥çš„å‰¯æœ¬
            except ValueError:
                matched = re.findall('[0-9]{4}', pub_year)
                if matched:
                    self.books_df['publishing_year'][i] = int(matched[0])
                else:
                    self.books_df['publishing_year'][i] = 0
```

### 7.

çœŸçš„æ— è¯­äº†ã€‚

```python
		sql_f3 = "SELECT * FROM douban_book_users"
        self.train = dict()

        self.cur.execute(sql_f3)
        results3 = self.cur.fetchall()
        for i in range(len(results3)):
            # å› ä¸ºread_book_and_scoreè¿™ä¸ªå­—æ®µæœ‰äº›æ•°æ®æ˜¯ä¸é—­åˆçš„ï¼Œæ‰€ä»¥è¦æ£€æŸ¥ä¸€ä¸‹
            if results3[i][3][-1] == '}':
                self.new_json = results3[i][3]  # ä¸èƒ½ç”¨results3[i][3]ç›´æ¥ä½œä¸ºå­—å…¸å€¼ï¼Œä»–æ˜¯å…ƒç»„
                self.train.setdefault(self.user, self.new_json)
            else:
                self.new_json = results3[i][3] + '}'
                self.train.setdefault(self.user, self.new_json)
```

å¿ƒæ€å·²ç»å´©äº†ï¼Œä¸æƒ³è¯´è¯

é¦–å…ˆresults3æ˜¯å…ƒç»„ï¼Œå½“åˆä¸èƒ½`results[i][3] += "}"`

### 8.è¿è¡Œç®—æ³•

![image-20210508223955446](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210508223955446.png)

ç®—åŒç°çŸ©é˜µçš„æ—¶å€™`Memory Error`äº†

![image-20210509000209993](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/image-20210509000209993.png)

é­é‡é‡å¤§å˜æ•…ï¼Œå†…å­˜çˆ†äº†.jpg

![å†…å­˜çˆ†äº†](https://horacehhtbucket.oss-cn-guangzhou.aliyuncs.com/img/å†…å­˜çˆ†äº†.png)

